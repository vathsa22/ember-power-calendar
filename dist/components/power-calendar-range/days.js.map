{"version":3,"file":"days.js","sources":["../../../src/components/power-calendar-range/days.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { scheduleOnce } from '@ember/runloop';\nimport { inject as service } from '@ember/service';\nimport type {\n  PowerCalendarDaysArgs,\n  PowerCalendarDaysSignature,\n} from '../power-calendar/days.ts';\nimport {\n  isBetween,\n  isSame,\n  diff,\n  isBefore,\n  add,\n  withLocale,\n  getWeekdaysMin,\n  getWeekdaysShort,\n  getWeekdays,\n  normalizeDate,\n  type PowerCalendarDay,\n} from '../../utils.ts';\nimport type { PowerCalendarRangeAPI } from '../power-calendar-range.ts';\nimport {\n  buildDay,\n  firstDay,\n  lastDay,\n  localeStartOfWeekOrFallback,\n  weekdaysNames,\n  weeks,\n  handleDayKeyDown,\n  focusDate,\n  handleClick,\n  type TWeekdayFormat,\n  type Week,\n} from '../../-private/days-utils.ts';\nimport type PowerCalendarService from '../../services/power-calendar.ts';\n\ninterface PowerCalendarMultipleDaysArgs\n  extends Omit<PowerCalendarDaysArgs, 'selected'> {\n  selected?: {\n    start: Date | null;\n    end: Date | null;\n  };\n}\n\ninterface PowerCalendarRangeSignature\n  extends Omit<PowerCalendarDaysSignature, 'Args'> {\n  Args: PowerCalendarMultipleDaysArgs;\n}\n\nexport default class PowerCalendarRangeDaysComponent extends Component<PowerCalendarRangeSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked focusedId: string | null = null;\n\n  get weekdayFormat(): TWeekdayFormat {\n    return this.args.weekdayFormat || 'short'; // \"min\" | \"short\" | \"long\"\n  }\n\n  get showDaysAround(): boolean {\n    return this.args.showDaysAround !== undefined\n      ? this.args.showDaysAround\n      : true;\n  }\n\n  get weekdaysMin(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysMin) as string[];\n  }\n\n  get weekdaysShort(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysShort) as string[];\n  }\n\n  get weekdays(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdays) as string[];\n  }\n\n  get localeStartOfWeek(): number {\n    return localeStartOfWeekOrFallback(\n      this.args.startOfWeek,\n      this.args.calendar.locale,\n    );\n  }\n\n  get weekdaysNames(): string[] {\n    return weekdaysNames(\n      this.localeStartOfWeek,\n      this.weekdayFormat,\n      this.weekdays,\n      this.weekdaysMin,\n      this.weekdaysShort,\n    );\n  }\n\n  get days(): PowerCalendarDay[] {\n    const today = this.powerCalendar.getDate();\n    const theLastDay = lastDay(this.localeStartOfWeek, this.currentCenter);\n    let day = firstDay(this.currentCenter, this.localeStartOfWeek);\n    const days: PowerCalendarDay[] = [];\n    while (isBefore(day, theLastDay)) {\n      days.push(\n        this.buildDay(day, today, this.args.calendar as PowerCalendarRangeAPI),\n      );\n      day = add(day, 1, 'day');\n    }\n    return days;\n  }\n\n  get weeks(): Week[] {\n    return weeks(this.days, this.showDaysAround);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n\n    if (!center) {\n      center = this.args.selected?.start || this.args.calendar.center;\n    }\n    return normalizeDate(center) || this.args.calendar.center;\n  }\n\n  // Actions\n  @action\n  handleDayFocus(e: FocusEvent): void {\n    scheduleOnce(\n      'actions',\n      this,\n      this._updateFocused,\n      (e.target as HTMLElement).dataset['date'],\n    );\n  }\n\n  @action\n  handleDayBlur(): void {\n    scheduleOnce('actions', this, this._updateFocused, null);\n  }\n\n  @action\n  handleKeyDown(e: KeyboardEvent): void {\n    const day = handleDayKeyDown(e, this.focusedId, this.days);\n    if (!day) {\n      return;\n    }\n    this.focusedId = day.id;\n    scheduleOnce(\n      'afterRender',\n      this,\n      focusDate,\n      this.args.calendar.uniqueId,\n      this.focusedId ?? '',\n    );\n  }\n\n  @action\n  handleClick(e: MouseEvent) {\n    handleClick(e, this.days, this.args.calendar);\n  }\n\n  // Methods\n  buildDay(date: Date, today: Date, calendar: PowerCalendarRangeAPI) {\n    const day = buildDay(\n      date,\n      today,\n      calendar,\n      this.focusedId,\n      this.currentCenter,\n      this.dayIsSelected.bind(this),\n      this.args.minDate,\n      this.args.maxDate,\n      this.args.disabledDates,\n    );\n\n    const { start, end } = calendar.selected || { start: null, end: null };\n    if (start && end) {\n      day.isSelected = isBetween(date, start, end, 'day', '[]');\n      day.isRangeStart = day.isSelected && isSame(date, start, 'day');\n      day.isRangeEnd = day.isSelected && isSame(date, end, 'day');\n    } else {\n      day.isRangeEnd = false;\n      if (!start) {\n        day.isRangeStart = false;\n      } else {\n        day.isRangeStart = day.isSelected = isSame(date, start, 'day');\n        if (!day.isDisabled) {\n          const diffInMs = Math.abs(diff(day.date, start));\n          const minRange = calendar.minRange;\n          const maxRange = calendar.maxRange;\n          day.isDisabled =\n            (minRange && diffInMs < minRange) ||\n            (maxRange !== null &&\n              maxRange !== undefined &&\n              diffInMs > maxRange);\n        }\n      }\n    }\n    return day;\n  }\n\n  dayIsSelected() {\n    return false;\n  }\n\n  _updateFocused(id?: string | null) {\n    this.focusedId = id ?? null;\n  }\n}\n"],"names":["PowerCalendarRangeDaysComponent","Component","g","prototype","service","i","void 0","tracked","weekdayFormat","args","showDaysAround","undefined","weekdaysMin","withLocale","calendar","locale","getWeekdaysMin","weekdaysShort","getWeekdaysShort","weekdays","getWeekdays","localeStartOfWeek","localeStartOfWeekOrFallback","startOfWeek","weekdaysNames","days","today","powerCalendar","getDate","theLastDay","lastDay","currentCenter","day","firstDay","isBefore","push","buildDay","add","weeks","center","selected","start","normalizeDate","handleDayFocus","e","scheduleOnce","_updateFocused","target","dataset","n","action","handleDayBlur","handleKeyDown","handleDayKeyDown","focusedId","id","focusDate","uniqueId","handleClick","date","dayIsSelected","bind","minDate","maxDate","disabledDates","end","isSelected","isBetween","isRangeStart","isSame","isRangeEnd","isDisabled","diffInMs","Math","abs","diff","minRange","maxRange","setComponentTemplate","TEMPLATE"],"mappings":"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"}