{"version":3,"file":"power-calendar-range.js","sources":["../../src/components/power-calendar-range.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { inject as service } from '@ember/service';\nimport { guidFor } from '@ember/object/internals';\nimport { assert } from '@ember/debug';\nimport { task } from 'ember-concurrency';\nimport PowerCalendarRangeDaysComponent from './power-calendar-range/days.ts';\nimport PowerCalendarNavComponent from './power-calendar/nav.ts';\nimport { publicActionsObject } from '../-private/utils.ts';\nimport {\n  normalizeDate,\n  normalizeRangeActionValue,\n  diff,\n  isAfter,\n  isBefore,\n  normalizeDuration,\n  normalizeCalendarValue,\n  type NormalizeRangeActionValue,\n  type PowerCalendarDay,\n  type SelectedPowerCalendarRange,\n} from '../utils.ts';\nimport type {\n  PowerCalendarAPI,\n  PowerCalendarSignature,\n  PowerCalendarArgs,\n  TCalendarType,\n  SelectedDays,\n  PowerCalendarActions,\n  CalendarDay,\n  CalendarAPI,\n} from './power-calendar.ts';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type PowerCalendarService from '../services/power-calendar.ts';\n\nexport interface PowerCalendarRangeDay extends Omit<PowerCalendarDay, 'date'> {\n  date: SelectedPowerCalendarRange;\n}\n\nexport const DAY_IN_MS = 86400000;\n\nexport type TPowerCalendarRangeOnSelect = (\n  day: NormalizeRangeActionValue,\n  calendar: PowerCalendarRangeAPI,\n  event: MouseEvent,\n) => void;\n\ninterface PowerCalendarRangeArgs\n  extends Omit<PowerCalendarArgs, 'selected' | 'onSelect'> {\n  selected?: SelectedPowerCalendarRange;\n  minRange?: number;\n  maxRange?: number;\n  proximitySelection?: boolean;\n  onSelect?: TPowerCalendarRangeOnSelect;\n}\n\nexport interface PowerCalendarRangeDefaultBlock extends PowerCalendarRangeAPI {\n  NavComponent: ComponentLike<any>;\n  DaysComponent: ComponentLike<any>;\n}\n\ninterface PowerCalendarRangeSignature\n  extends Omit<PowerCalendarSignature, 'Args' | 'Blocks'> {\n  Args: PowerCalendarRangeArgs;\n  Blocks: {\n    default: [PowerCalendarRangeDefaultBlock];\n  };\n}\n\nexport interface PowerCalendarRangeAPI\n  extends Omit<PowerCalendarAPI, 'selected'> {\n  selected?: SelectedPowerCalendarRange;\n  minRange?: number | null;\n  maxRange?: number | null;\n}\n\nexport default class PowerCalendarRangeComponent extends Component<PowerCalendarRangeSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked center = null;\n  @tracked _calendarType: TCalendarType = 'range';\n  @tracked _selected?: SelectedDays;\n\n  navComponent: ComponentLike<any> = PowerCalendarNavComponent;\n  daysComponent: ComponentLike<any> = PowerCalendarRangeDaysComponent;\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: PowerCalendarRangeArgs) {\n    super(owner, args);\n    this.registerCalendar();\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n  }\n\n  willDestroy(): void {\n    super.willDestroy();\n    this.unregisterCalendar();\n  }\n\n  get publicActions(): PowerCalendarActions {\n    return publicActionsObject(\n      this.args.onSelect,\n      this.select,\n      this.args.onCenterChange,\n      this.changeCenterTask,\n      this.currentCenter,\n    );\n  }\n\n  get selected(): SelectedPowerCalendarRange {\n    if (this._selected) {\n      return this._selected as SelectedPowerCalendarRange;\n    }\n\n    if (this.args.selected) {\n      return {\n        start: normalizeDate(this.args.selected.start),\n        end: normalizeDate(this.args.selected.end),\n      };\n    }\n\n    return { start: undefined, end: undefined };\n  }\n\n  set selected(v) {\n    if (v === undefined || v === null) {\n      v = {};\n    }\n    this._selected = {\n      start: normalizeDate(v.start),\n      end: normalizeDate(v.end),\n    };\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n    if (!center) {\n      center = this.selected.start || this.powerCalendar.getDate();\n    }\n    return normalizeDate(center) || this.powerCalendar.getDate();\n  }\n\n  get publicAPI(): PowerCalendarRangeAPI {\n    return {\n      uniqueId: guidFor(this),\n      type: this._calendarType,\n      selected: this.selected,\n      loading: this.changeCenterTask.isRunning,\n      center: this.currentCenter,\n      locale: this.args.locale || this.powerCalendar.locale,\n      actions: this.publicActions,\n      minRange: this.minRange,\n      maxRange: this.maxRange,\n    };\n  }\n\n  get tagWithDefault(): string {\n    if (this.args.tag === undefined || this.args.tag === null) {\n      return 'div';\n    }\n    return this.args.tag;\n  }\n\n  get proximitySelection(): boolean {\n    return this.args.proximitySelection !== undefined\n      ? this.args.proximitySelection\n      : false;\n  }\n\n  get minRange(): number | null {\n    if (this.args.minRange !== undefined) {\n      return this._formatRange(this.args.minRange) as number;\n    }\n\n    return DAY_IN_MS;\n  }\n\n  get maxRange(): number | null {\n    if (this.args.maxRange !== undefined) {\n      return this._formatRange(this.args.maxRange) as number;\n    }\n\n    return null;\n  }\n\n  // Tasks\n  changeCenterTask = task(\n    async (newCenter: Date, calendar: PowerCalendarRangeAPI, e: MouseEvent) => {\n      assert(\n        \"You attempted to move the center of a calendar that doesn't receive an `@onCenterChange` action.\",\n        typeof this.args.onCenterChange === 'function',\n      );\n      const value = normalizeCalendarValue({ date: newCenter });\n      await this.args.onCenterChange(value, calendar, e);\n    },\n  );\n\n  // Actions\n  @action\n  select(day: CalendarDay, calendar: CalendarAPI, e: MouseEvent) {\n    const { date } = day as NormalizeRangeActionValue;\n    assert(\n      'date must be either a Date, or a Range',\n      date &&\n        (ownProp(date, 'start') ||\n          ownProp(date, 'end') ||\n          date instanceof Date),\n    );\n\n    let range: NormalizeRangeActionValue;\n\n    if (ownProp(date, 'start') && ownProp(date, 'end')) {\n      range = { date };\n    } else {\n      range = this._buildRange({ date } as { date: Date });\n    }\n\n    const { start, end } = range.date;\n    if (start && end) {\n      const { minRange, maxRange } = this.publicAPI;\n      const diffInMs = Math.abs(diff(end, start));\n      if (\n        diffInMs < (minRange ?? DAY_IN_MS) ||\n        (maxRange && diffInMs > maxRange)\n      ) {\n        return;\n      }\n    }\n\n    if (this.args.onSelect) {\n      this.args.onSelect(range, calendar as PowerCalendarRangeAPI, e);\n    }\n  }\n\n  _formatRange(v: number | undefined) {\n    if (typeof v === 'number') {\n      return v * DAY_IN_MS;\n    }\n\n    return normalizeDuration(v === undefined ? DAY_IN_MS : v);\n  }\n\n  // Methods\n  _buildRange(day: { date: Date }): NormalizeRangeActionValue {\n    const selected = this.selected || { start: null, end: null };\n    const { start, end } = selected;\n\n    if (this.proximitySelection) {\n      return this._buildRangeByProximity(day, start, end);\n    }\n\n    return this._buildDefaultRange(day, start, end);\n  }\n\n  _buildRangeByProximity(\n    day: { date: Date },\n    start?: Date | null,\n    end?: Date | null,\n  ): NormalizeRangeActionValue {\n    if (start && end) {\n      const changeStart =\n        Math.abs(diff(day.date, end)) > Math.abs(diff(day.date, start));\n\n      return normalizeRangeActionValue({\n        date: {\n          start: changeStart ? day.date : start,\n          end: changeStart ? end : day.date,\n        },\n      });\n    }\n\n    if (start && isBefore(day.date, start)) {\n      return normalizeRangeActionValue({\n        date: { start: day.date, end: null },\n      });\n    }\n\n    return this._buildDefaultRange(day, start, end);\n  }\n\n  _buildDefaultRange(\n    day: { date: Date },\n    start?: Date | null,\n    end?: Date | null,\n  ): NormalizeRangeActionValue {\n    if (start && !end) {\n      if (isAfter(start, day.date)) {\n        return normalizeRangeActionValue({\n          date: { start: day.date, end: start },\n        });\n      }\n      return normalizeRangeActionValue({\n        date: { start: start, end: day.date },\n      });\n    }\n\n    return normalizeRangeActionValue({ date: { start: day.date, end: null } });\n  }\n\n  // Methods\n  registerCalendar() {\n    if (window) {\n      // @ts-expect-error Property '__powerCalendars'\n      window.__powerCalendars = window.__powerCalendars || {}; // TODO: weakmap??\n      // @ts-expect-error Property '__powerCalendars'\n      window.__powerCalendars[this.publicAPI.uniqueId] = this;\n    }\n  }\n\n  unregisterCalendar() {\n    // @ts-expect-error Property '__powerCalendars'\n    if (window && window.__powerCalendars?.[guidFor(this)]) {\n      // @ts-expect-error Property '__powerCalendars'\n      delete window.__powerCalendars[guidFor(this)];\n    }\n  }\n}\n\nfunction ownProp<T = { [key: string | number]: any }>(obj: T, prop: keyof T) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n"],"names":["DAY_IN_MS","PowerCalendarRangeComponent","Component","g","prototype","service","i","void 0","tracked","navComponent","PowerCalendarNavComponent","daysComponent","PowerCalendarRangeDaysComponent","constructor","owner","args","registerCalendar","onInit","publicAPI","willDestroy","unregisterCalendar","publicActions","publicActionsObject","onSelect","select","onCenterChange","changeCenterTask","currentCenter","selected","_selected","start","normalizeDate","end","undefined","v","center","powerCalendar","getDate","uniqueId","guidFor","type","_calendarType","loading","isRunning","locale","actions","minRange","maxRange","tagWithDefault","tag","proximitySelection","_formatRange","_buildTask","context","generator","newCenter","calendar","e","assert","value","normalizeCalendarValue","date","day","ownProp","Date","range","_buildRange","diffInMs","Math","abs","diff","n","action","normalizeDuration","_buildRangeByProximity","_buildDefaultRange","changeStart","normalizeRangeActionValue","isBefore","isAfter","window","__powerCalendars","obj","prop","Object","hasOwnProperty","call","setComponentTemplate","TEMPLATE"],"mappings":"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"}