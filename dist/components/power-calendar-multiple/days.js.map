{"version":3,"file":"days.js","sources":["../../../src/components/power-calendar-multiple/days.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { scheduleOnce } from '@ember/runloop';\nimport { inject as service } from '@ember/service';\nimport {\n  add,\n  getWeekdays,\n  getWeekdaysMin,\n  getWeekdaysShort,\n  isBefore,\n  isSame,\n  normalizeDate,\n  withLocale,\n  type PowerCalendarDay,\n} from '../../utils.ts';\nimport type { PowerCalendarMultipleAPI } from '../power-calendar-multiple.ts';\nimport {\n  buildDay,\n  dayIsDisabled,\n  firstDay,\n  lastDay,\n  localeStartOfWeekOrFallback,\n  weekdaysNames,\n  weeks,\n  handleDayKeyDown,\n  focusDate,\n  handleClick,\n  type TWeekdayFormat,\n  type Week,\n} from '../../-private/days-utils.ts';\nimport type { CalendarAPI } from '../power-calendar.ts';\nimport type PowerCalendarService from '../../services/power-calendar.ts';\nimport type {\n  PowerCalendarDaysArgs,\n  PowerCalendarDaysSignature,\n} from '../power-calendar/days.ts';\n\ninterface PowerCalendarMultipleDaysArgs\n  extends Omit<PowerCalendarDaysArgs, 'selected'> {\n  selected?: Date[];\n  maxLength?: number;\n}\n\ninterface PowerCalendarMultipleDaysSignature\n  extends Omit<PowerCalendarDaysSignature, 'Args'> {\n  Args: PowerCalendarMultipleDaysArgs;\n}\n\nexport default class PowerCalendarMultipleDaysComponent extends Component<PowerCalendarMultipleDaysSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked focusedId: string | null = null;\n\n  get weekdayFormat(): TWeekdayFormat {\n    return this.args.weekdayFormat || 'short'; // \"min\" | \"short\" | \"long\"\n  }\n\n  get showDaysAround(): boolean {\n    return this.args.showDaysAround !== undefined\n      ? this.args.showDaysAround\n      : true;\n  }\n\n  get weekdaysMin(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysMin) as string[];\n  }\n\n  get weekdaysShort(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysShort) as string[];\n  }\n\n  get weekdays(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdays) as string[];\n  }\n\n  get localeStartOfWeek(): number {\n    return localeStartOfWeekOrFallback(\n      this.args.startOfWeek,\n      this.args.calendar.locale,\n    );\n  }\n\n  get weekdaysNames(): string[] {\n    return weekdaysNames(\n      this.localeStartOfWeek,\n      this.weekdayFormat,\n      this.weekdays,\n      this.weekdaysMin,\n      this.weekdaysShort,\n    );\n  }\n\n  get days(): PowerCalendarDay[] {\n    const today = this.powerCalendar.getDate();\n    const theLastDay = lastDay(this.localeStartOfWeek, this.currentCenter);\n    let day = firstDay(this.currentCenter, this.localeStartOfWeek);\n    const days: PowerCalendarDay[] = [];\n    while (isBefore(day, theLastDay)) {\n      days.push(\n        buildDay(\n          day,\n          today,\n          this.args.calendar,\n          this.focusedId,\n          this.currentCenter,\n          this.dayIsSelected.bind(this),\n          this.args.minDate,\n          this.args.maxDate,\n          this.args.disabledDates,\n          this.dayIsDisabled.bind(this),\n        ),\n      );\n      day = add(day, 1, 'day');\n    }\n    return days;\n  }\n\n  get weeks(): Week[] {\n    return weeks(this.days, this.showDaysAround);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n    if (!center) {\n      center = this.args.selected\n        ? this.args.selected[0]\n        : this.args.calendar.center;\n    }\n    return normalizeDate(center) || this.args.calendar.center;\n  }\n\n  get maxLength(): number {\n    return this.args.maxLength || Infinity;\n  }\n\n  // Actions\n  @action\n  handleDayFocus(e: FocusEvent): void {\n    scheduleOnce(\n      'actions',\n      this,\n      this._updateFocused,\n      (e.target as HTMLElement).dataset['date'],\n    );\n  }\n\n  @action\n  handleDayBlur(): void {\n    scheduleOnce('actions', this, this._updateFocused, null);\n  }\n\n  @action\n  handleKeyDown(e: KeyboardEvent): void {\n    const day = handleDayKeyDown(e, this.focusedId, this.days);\n    if (!day) {\n      return;\n    }\n    this.focusedId = day.id;\n    scheduleOnce(\n      'afterRender',\n      this,\n      focusDate,\n      this.args.calendar.uniqueId,\n      this.focusedId ?? '',\n    );\n  }\n\n  @action\n  handleClick(e: MouseEvent) {\n    handleClick(e, this.days, this.args.calendar);\n  }\n\n  // Methods\n  dayIsSelected(date: Date, calendar: CalendarAPI = this.args.calendar) {\n    const selected = (calendar as PowerCalendarMultipleAPI).selected || [];\n    return selected.some((d) => isSame(date, d, 'day'));\n  }\n\n  _updateFocused(id?: string | null) {\n    this.focusedId = id ?? null;\n  }\n\n  dayIsDisabled(\n    date: Date,\n    calendarApi: CalendarAPI,\n    minDate?: Date,\n    maxDate?: Date,\n    disabledDates?: Array<Date | string>,\n  ) {\n    const calendar = calendarApi as PowerCalendarMultipleAPI;\n    const numSelected = (calendar.selected && calendar.selected.length) || 0;\n    const maxLength = this.maxLength || Infinity;\n    return (\n      dayIsDisabled(date, calendar, minDate, maxDate, disabledDates) ||\n      (numSelected >= maxLength && !this.dayIsSelected(date))\n    );\n  }\n}\n"],"names":["PowerCalendarMultipleDaysComponent","Component","g","prototype","service","i","void 0","tracked","weekdayFormat","args","showDaysAround","undefined","weekdaysMin","withLocale","calendar","locale","getWeekdaysMin","weekdaysShort","getWeekdaysShort","weekdays","getWeekdays","localeStartOfWeek","localeStartOfWeekOrFallback","startOfWeek","weekdaysNames","days","today","powerCalendar","getDate","theLastDay","lastDay","currentCenter","day","firstDay","isBefore","push","buildDay","focusedId","dayIsSelected","bind","minDate","maxDate","disabledDates","dayIsDisabled","add","weeks","center","selected","normalizeDate","maxLength","Infinity","handleDayFocus","e","scheduleOnce","_updateFocused","target","dataset","n","action","handleDayBlur","handleKeyDown","handleDayKeyDown","id","focusDate","uniqueId","handleClick","date","some","d","isSame","calendarApi","numSelected","length","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;;;;;AAiDe,MAAMA,kCAAkC,SAASC,SAAS,CAAqC;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,eAAA,EAAA,CAC3GC,MAAO,CAAA,CAAA;AAAA;AAAA,EAAA,cAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,eAAA,CAAA,EAAAC,KAAA,CAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,WAAA,EAAA,CAEPI,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAA4B,IAAI;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,UAAA,IAAAF,CAAA,CAAA,IAAA,EAAA,WAAA,CAAA,EAAAC,KAAA,CAAA;EAExC,IAAIE,aAAaA,GAAmB;IAClC,OAAO,IAAI,CAACC,IAAI,CAACD,aAAa,IAAI,OAAO,CAAC;AAC5C;EAEA,IAAIE,cAAcA,GAAY;AAC5B,IAAA,OAAO,IAAI,CAACD,IAAI,CAACC,cAAc,KAAKC,SAAS,GACzC,IAAI,CAACF,IAAI,CAACC,cAAc,GACxB,IAAI;AACV;EAEA,IAAIE,WAAWA,GAAa;IAC1B,OAAOC,UAAU,CAAC,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAACC,MAAM,EAAEC,cAAc,CAAC;AAC9D;EAEA,IAAIC,aAAaA,GAAa;IAC5B,OAAOJ,UAAU,CAAC,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAACC,MAAM,EAAEG,gBAAgB,CAAC;AAChE;EAEA,IAAIC,QAAQA,GAAa;IACvB,OAAON,UAAU,CAAC,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAACC,MAAM,EAAEK,WAAW,CAAC;AAC3D;EAEA,IAAIC,iBAAiBA,GAAW;AAC9B,IAAA,OAAOC,2BAA2B,CAChC,IAAI,CAACb,IAAI,CAACc,WAAW,EACrB,IAAI,CAACd,IAAI,CAACK,QAAQ,CAACC,MACrB,CAAC;AACH;EAEA,IAAIS,aAAaA,GAAa;IAC5B,OAAOA,aAAa,CAClB,IAAI,CAACH,iBAAiB,EACtB,IAAI,CAACb,aAAa,EAClB,IAAI,CAACW,QAAQ,EACb,IAAI,CAACP,WAAW,EAChB,IAAI,CAACK,aACP,CAAC;AACH;EAEA,IAAIQ,IAAIA,GAAuB;IAC7B,MAAMC,KAAK,GAAG,IAAI,CAACC,aAAa,CAACC,OAAO,EAAE;IAC1C,MAAMC,UAAU,GAAGC,OAAO,CAAC,IAAI,CAACT,iBAAiB,EAAE,IAAI,CAACU,aAAa,CAAC;IACtE,IAAIC,GAAG,GAAGC,QAAQ,CAAC,IAAI,CAACF,aAAa,EAAE,IAAI,CAACV,iBAAiB,CAAC;IAC9D,MAAMI,IAAwB,GAAG,EAAE;AACnC,IAAA,OAAOS,QAAQ,CAACF,GAAG,EAAEH,UAAU,CAAC,EAAE;MAChCJ,IAAI,CAACU,IAAI,CACPC,QAAQ,CACNJ,GAAG,EACHN,KAAK,EACL,IAAI,CAACjB,IAAI,CAACK,QAAQ,EAClB,IAAI,CAACuB,SAAS,EACd,IAAI,CAACN,aAAa,EAClB,IAAI,CAACO,aAAa,CAACC,IAAI,CAAC,IAAI,CAAC,EAC7B,IAAI,CAAC9B,IAAI,CAAC+B,OAAO,EACjB,IAAI,CAAC/B,IAAI,CAACgC,OAAO,EACjB,IAAI,CAAChC,IAAI,CAACiC,aAAa,EACvB,IAAI,CAACC,aAAa,CAACJ,IAAI,CAAC,IAAI,CAC9B,CACF,CAAC;MACDP,GAAG,GAAGY,GAAG,CAACZ,GAAG,EAAE,CAAC,EAAE,KAAK,CAAC;AAC1B;AACA,IAAA,OAAOP,IAAI;AACb;EAEA,IAAIoB,KAAKA,GAAW;IAClB,OAAOA,KAAK,CAAC,IAAI,CAACpB,IAAI,EAAE,IAAI,CAACf,cAAc,CAAC;AAC9C;EAEA,IAAIqB,aAAaA,GAAS;AACxB,IAAA,IAAIe,MAAM,GAAG,IAAI,CAACrC,IAAI,CAACqC,MAAM;IAC7B,IAAI,CAACA,MAAM,EAAE;MACXA,MAAM,GAAG,IAAI,CAACrC,IAAI,CAACsC,QAAQ,GACvB,IAAI,CAACtC,IAAI,CAACsC,QAAQ,CAAC,CAAC,CAAC,GACrB,IAAI,CAACtC,IAAI,CAACK,QAAQ,CAACgC,MAAM;AAC/B;IACA,OAAOE,aAAa,CAACF,MAAM,CAAC,IAAI,IAAI,CAACrC,IAAI,CAACK,QAAQ,CAACgC,MAAM;AAC3D;EAEA,IAAIG,SAASA,GAAW;AACtB,IAAA,OAAO,IAAI,CAACxC,IAAI,CAACwC,SAAS,IAAIC,QAAQ;AACxC;;AAEA;EAEAC,cAAcA,CAACC,CAAa,EAAQ;AAClCC,IAAAA,YAAY,CACV,SAAS,EACT,IAAI,EACJ,IAAI,CAACC,cAAc,EAClBF,CAAC,CAACG,MAAM,CAAiBC,OAAO,CAAC,MAAM,CAC1C,CAAC;AACH;AAAC,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAtD,SAAA,EAAA,gBAAA,EAAA,CARAuD,MAAM,CAAA,CAAA;AAAA;AAWPC,EAAAA,aAAaA,GAAS;IACpBN,YAAY,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAACC,cAAc,EAAE,IAAI,CAAC;AAC1D;AAAC,EAAA;IAAAG,CAAA,CAAA,IAAA,CAAAtD,SAAA,EAAA,eAAA,EAAA,CAHAuD,MAAM,CAAA,CAAA;AAAA;EAMPE,aAAaA,CAACR,CAAgB,EAAQ;AACpC,IAAA,MAAMpB,GAAG,GAAG6B,gBAAgB,CAACT,CAAC,EAAE,IAAI,CAACf,SAAS,EAAE,IAAI,CAACZ,IAAI,CAAC;IAC1D,IAAI,CAACO,GAAG,EAAE;AACR,MAAA;AACF;AACA,IAAA,IAAI,CAACK,SAAS,GAAGL,GAAG,CAAC8B,EAAE;IACvBT,YAAY,CACV,aAAa,EACb,IAAI,EACJU,SAAS,EACT,IAAI,CAACtD,IAAI,CAACK,QAAQ,CAACkD,QAAQ,EAC3B,IAAI,CAAC3B,SAAS,IAAI,EACpB,CAAC;AACH;AAAC,EAAA;IAAAoB,CAAA,CAAA,IAAA,CAAAtD,SAAA,EAAA,eAAA,EAAA,CAdAuD,MAAM,CAAA,CAAA;AAAA;EAiBPO,WAAWA,CAACb,CAAa,EAAE;AACzBa,IAAAA,WAAW,CAACb,CAAC,EAAE,IAAI,CAAC3B,IAAI,EAAE,IAAI,CAAChB,IAAI,CAACK,QAAQ,CAAC;AAC/C;;AAEA;AAAA,EAAA;IAAA2C,CAAA,CAAA,IAAA,CAAAtD,SAAA,EAAA,aAAA,EAAA,CALCuD,MAAM,CAAA,CAAA;AAAA;EAMPpB,aAAaA,CAAC4B,IAAU,EAAEpD,QAAqB,GAAG,IAAI,CAACL,IAAI,CAACK,QAAQ,EAAE;AACpE,IAAA,MAAMiC,QAAQ,GAAIjC,QAAQ,CAA8BiC,QAAQ,IAAI,EAAE;AACtE,IAAA,OAAOA,QAAQ,CAACoB,IAAI,CAAEC,CAAC,IAAKC,MAAM,CAACH,IAAI,EAAEE,CAAC,EAAE,KAAK,CAAC,CAAC;AACrD;EAEAd,cAAcA,CAACQ,EAAkB,EAAE;AACjC,IAAA,IAAI,CAACzB,SAAS,GAAGyB,EAAE,IAAI,IAAI;AAC7B;EAEAnB,aAAaA,CACXuB,IAAU,EACVI,WAAwB,EACxB9B,OAAc,EACdC,OAAc,EACdC,aAAoC,EACpC;IACA,MAAM5B,QAAQ,GAAGwD,WAAuC;AACxD,IAAA,MAAMC,WAAW,GAAIzD,QAAQ,CAACiC,QAAQ,IAAIjC,QAAQ,CAACiC,QAAQ,CAACyB,MAAM,IAAK,CAAC;AACxE,IAAA,MAAMvB,SAAS,GAAG,IAAI,CAACA,SAAS,IAAIC,QAAQ;IAC5C,OACEP,aAAa,CAACuB,IAAI,EAAEpD,QAAQ,EAAE0B,OAAO,EAAEC,OAAO,EAAEC,aAAa,CAAC,IAC7D6B,WAAW,IAAItB,SAAS,IAAI,CAAC,IAAI,CAACX,aAAa,CAAC4B,IAAI,CAAE;AAE3D;AACF;AAACO,oBAAA,CAAAC,QAAA,EArJoB1E,kCAAkC,CAAA;;;;"}