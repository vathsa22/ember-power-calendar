{"version":3,"file":"days.js","sources":["../../../src/components/power-calendar/days.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { scheduleOnce } from '@ember/runloop';\nimport { inject as service } from '@ember/service';\nimport {\n  add,\n  getWeekdays,\n  getWeekdaysMin,\n  getWeekdaysShort,\n  isBefore,\n  isSame,\n  normalizeDate,\n  withLocale,\n  type PowerCalendarDay,\n} from '../../utils.ts';\nimport type { CalendarAPI } from '../power-calendar.ts';\nimport type PowerCalendarService from '../../services/power-calendar.ts';\nimport {\n  firstDay,\n  localeStartOfWeekOrFallback,\n  weekdaysNames,\n  weeks,\n  handleDayKeyDown,\n  focusDate,\n  buildDay,\n  lastDay,\n  handleClick,\n  type TWeekdayFormat,\n  type Week,\n} from '../../-private/days-utils.ts';\n\nexport interface PowerCalendarDaysArgs {\n  calendar: CalendarAPI;\n  dayClass?: string;\n  disabledDates?: Array<Date | string>;\n  maxDate?: Date;\n  minDate?: Date;\n  selected?: Date;\n  showDaysAround?: boolean;\n  startOfWeek?: string;\n  center?: Date;\n  weekdayFormat?: TWeekdayFormat;\n}\n\nexport interface PowerCalendarDaysSignature {\n  Element: HTMLElement;\n  Args: PowerCalendarDaysArgs;\n  Blocks: {\n    default: [day: PowerCalendarDay, calendar: CalendarAPI, weeks: Week[]];\n  };\n}\n\nexport default class PowerCalendarDaysComponent extends Component<PowerCalendarDaysSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked focusedId: string | null = null;\n\n  get weekdayFormat(): TWeekdayFormat {\n    return this.args.weekdayFormat || 'short'; // \"min\" | \"short\" | \"long\"\n  }\n\n  get showDaysAround(): boolean {\n    return this.args.showDaysAround !== undefined\n      ? this.args.showDaysAround\n      : true;\n  }\n\n  get weekdaysMin(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysMin) as string[];\n  }\n\n  get weekdaysShort(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysShort) as string[];\n  }\n\n  get weekdays(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdays) as string[];\n  }\n\n  get localeStartOfWeek(): number {\n    return localeStartOfWeekOrFallback(\n      this.args.startOfWeek,\n      this.args.calendar.locale,\n    );\n  }\n\n  get weekdaysNames(): string[] {\n    return weekdaysNames(\n      this.localeStartOfWeek,\n      this.weekdayFormat,\n      this.weekdays,\n      this.weekdaysMin,\n      this.weekdaysShort,\n    );\n  }\n\n  get days(): PowerCalendarDay[] {\n    const today = this.powerCalendar.getDate();\n    const theLastDay = lastDay(this.localeStartOfWeek, this.currentCenter);\n    let day = firstDay(this.currentCenter, this.localeStartOfWeek);\n    const days: PowerCalendarDay[] = [];\n    while (isBefore(day, theLastDay)) {\n      days.push(\n        buildDay(\n          day,\n          today,\n          this.args.calendar,\n          this.focusedId,\n          this.currentCenter,\n          this.dayIsSelected.bind(this),\n          this.args.minDate,\n          this.args.maxDate,\n          this.args.disabledDates,\n        ),\n      );\n      day = add(day, 1, 'day');\n    }\n    return days;\n  }\n\n  get weeks(): Week[] {\n    return weeks(this.days, this.showDaysAround);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n    if (!center) {\n      center = this.args.selected || this.args.calendar.center;\n    }\n    return normalizeDate(center) || this.args.calendar.center;\n  }\n\n  // Actions\n  @action\n  handleDayFocus(e: FocusEvent): void {\n    scheduleOnce(\n      'actions',\n      this,\n      this._updateFocused,\n      (e.target as HTMLElement).dataset['date'],\n    );\n  }\n\n  @action\n  handleDayBlur(): void {\n    scheduleOnce('actions', this, this._updateFocused, null);\n  }\n\n  @action\n  handleKeyDown(e: KeyboardEvent): void {\n    const day = handleDayKeyDown(e, this.focusedId, this.days);\n    if (!day) {\n      return;\n    }\n    this.focusedId = day.id;\n    scheduleOnce(\n      'afterRender',\n      this,\n      focusDate,\n      this.args.calendar.uniqueId,\n      this.focusedId ?? '',\n    );\n  }\n\n  @action\n  handleClick(e: MouseEvent) {\n    handleClick(e, this.days, this.args.calendar);\n  }\n\n  // Methods\n  dayIsSelected(date: Date, calendar: CalendarAPI = this.args.calendar) {\n    return calendar.selected\n      ? isSame(date, calendar.selected as Date, 'day')\n      : false;\n  }\n\n  _updateFocused(id?: string | null) {\n    this.focusedId = id ?? null;\n  }\n}\n"],"names":["PowerCalendarDaysComponent","Component","g","prototype","service","i","void 0","tracked","weekdayFormat","args","showDaysAround","undefined","weekdaysMin","withLocale","calendar","locale","getWeekdaysMin","weekdaysShort","getWeekdaysShort","weekdays","getWeekdays","localeStartOfWeek","localeStartOfWeekOrFallback","startOfWeek","weekdaysNames","days","today","powerCalendar","getDate","theLastDay","lastDay","currentCenter","day","firstDay","isBefore","push","buildDay","focusedId","dayIsSelected","bind","minDate","maxDate","disabledDates","add","weeks","center","selected","normalizeDate","handleDayFocus","e","scheduleOnce","_updateFocused","target","dataset","n","action","handleDayBlur","handleKeyDown","handleDayKeyDown","id","focusDate","uniqueId","handleClick","date","isSame","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;;;;;AAqDe,MAAMA,0BAA0B,SAASC,SAAS,CAA6B;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,eAAA,EAAA,CAC3FC,MAAO,CAAA,CAAA;AAAA;AAAA,EAAA,cAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,eAAA,CAAA,EAAAC,KAAA,CAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,WAAA,EAAA,CAEPI,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAA4B,IAAI;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,UAAA,IAAAF,CAAA,CAAA,IAAA,EAAA,WAAA,CAAA,EAAAC,KAAA,CAAA;EAExC,IAAIE,aAAaA,GAAmB;IAClC,OAAO,IAAI,CAACC,IAAI,CAACD,aAAa,IAAI,OAAO,CAAC;AAC5C;EAEA,IAAIE,cAAcA,GAAY;AAC5B,IAAA,OAAO,IAAI,CAACD,IAAI,CAACC,cAAc,KAAKC,SAAS,GACzC,IAAI,CAACF,IAAI,CAACC,cAAc,GACxB,IAAI;AACV;EAEA,IAAIE,WAAWA,GAAa;IAC1B,OAAOC,UAAU,CAAC,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAACC,MAAM,EAAEC,cAAc,CAAC;AAC9D;EAEA,IAAIC,aAAaA,GAAa;IAC5B,OAAOJ,UAAU,CAAC,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAACC,MAAM,EAAEG,gBAAgB,CAAC;AAChE;EAEA,IAAIC,QAAQA,GAAa;IACvB,OAAON,UAAU,CAAC,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAACC,MAAM,EAAEK,WAAW,CAAC;AAC3D;EAEA,IAAIC,iBAAiBA,GAAW;AAC9B,IAAA,OAAOC,2BAA2B,CAChC,IAAI,CAACb,IAAI,CAACc,WAAW,EACrB,IAAI,CAACd,IAAI,CAACK,QAAQ,CAACC,MACrB,CAAC;AACH;EAEA,IAAIS,aAAaA,GAAa;IAC5B,OAAOA,aAAa,CAClB,IAAI,CAACH,iBAAiB,EACtB,IAAI,CAACb,aAAa,EAClB,IAAI,CAACW,QAAQ,EACb,IAAI,CAACP,WAAW,EAChB,IAAI,CAACK,aACP,CAAC;AACH;EAEA,IAAIQ,IAAIA,GAAuB;IAC7B,MAAMC,KAAK,GAAG,IAAI,CAACC,aAAa,CAACC,OAAO,EAAE;IAC1C,MAAMC,UAAU,GAAGC,OAAO,CAAC,IAAI,CAACT,iBAAiB,EAAE,IAAI,CAACU,aAAa,CAAC;IACtE,IAAIC,GAAG,GAAGC,QAAQ,CAAC,IAAI,CAACF,aAAa,EAAE,IAAI,CAACV,iBAAiB,CAAC;IAC9D,MAAMI,IAAwB,GAAG,EAAE;AACnC,IAAA,OAAOS,QAAQ,CAACF,GAAG,EAAEH,UAAU,CAAC,EAAE;MAChCJ,IAAI,CAACU,IAAI,CACPC,QAAQ,CACNJ,GAAG,EACHN,KAAK,EACL,IAAI,CAACjB,IAAI,CAACK,QAAQ,EAClB,IAAI,CAACuB,SAAS,EACd,IAAI,CAACN,aAAa,EAClB,IAAI,CAACO,aAAa,CAACC,IAAI,CAAC,IAAI,CAAC,EAC7B,IAAI,CAAC9B,IAAI,CAAC+B,OAAO,EACjB,IAAI,CAAC/B,IAAI,CAACgC,OAAO,EACjB,IAAI,CAAChC,IAAI,CAACiC,aACZ,CACF,CAAC;MACDV,GAAG,GAAGW,GAAG,CAACX,GAAG,EAAE,CAAC,EAAE,KAAK,CAAC;AAC1B;AACA,IAAA,OAAOP,IAAI;AACb;EAEA,IAAImB,KAAKA,GAAW;IAClB,OAAOA,KAAK,CAAC,IAAI,CAACnB,IAAI,EAAE,IAAI,CAACf,cAAc,CAAC;AAC9C;EAEA,IAAIqB,aAAaA,GAAS;AACxB,IAAA,IAAIc,MAAM,GAAG,IAAI,CAACpC,IAAI,CAACoC,MAAM;IAC7B,IAAI,CAACA,MAAM,EAAE;AACXA,MAAAA,MAAM,GAAG,IAAI,CAACpC,IAAI,CAACqC,QAAQ,IAAI,IAAI,CAACrC,IAAI,CAACK,QAAQ,CAAC+B,MAAM;AAC1D;IACA,OAAOE,aAAa,CAACF,MAAM,CAAC,IAAI,IAAI,CAACpC,IAAI,CAACK,QAAQ,CAAC+B,MAAM;AAC3D;;AAEA;EAEAG,cAAcA,CAACC,CAAa,EAAQ;AAClCC,IAAAA,YAAY,CACV,SAAS,EACT,IAAI,EACJ,IAAI,CAACC,cAAc,EAClBF,CAAC,CAACG,MAAM,CAAiBC,OAAO,CAAC,MAAM,CAC1C,CAAC;AACH;AAAC,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAnD,SAAA,EAAA,gBAAA,EAAA,CARAoD,MAAM,CAAA,CAAA;AAAA;AAWPC,EAAAA,aAAaA,GAAS;IACpBN,YAAY,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAACC,cAAc,EAAE,IAAI,CAAC;AAC1D;AAAC,EAAA;IAAAG,CAAA,CAAA,IAAA,CAAAnD,SAAA,EAAA,eAAA,EAAA,CAHAoD,MAAM,CAAA,CAAA;AAAA;EAMPE,aAAaA,CAACR,CAAgB,EAAQ;AACpC,IAAA,MAAMjB,GAAG,GAAG0B,gBAAgB,CAACT,CAAC,EAAE,IAAI,CAACZ,SAAS,EAAE,IAAI,CAACZ,IAAI,CAAC;IAC1D,IAAI,CAACO,GAAG,EAAE;AACR,MAAA;AACF;AACA,IAAA,IAAI,CAACK,SAAS,GAAGL,GAAG,CAAC2B,EAAE;IACvBT,YAAY,CACV,aAAa,EACb,IAAI,EACJU,SAAS,EACT,IAAI,CAACnD,IAAI,CAACK,QAAQ,CAAC+C,QAAQ,EAC3B,IAAI,CAACxB,SAAS,IAAI,EACpB,CAAC;AACH;AAAC,EAAA;IAAAiB,CAAA,CAAA,IAAA,CAAAnD,SAAA,EAAA,eAAA,EAAA,CAdAoD,MAAM,CAAA,CAAA;AAAA;EAiBPO,WAAWA,CAACb,CAAa,EAAE;AACzBa,IAAAA,WAAW,CAACb,CAAC,EAAE,IAAI,CAACxB,IAAI,EAAE,IAAI,CAAChB,IAAI,CAACK,QAAQ,CAAC;AAC/C;;AAEA;AAAA,EAAA;IAAAwC,CAAA,CAAA,IAAA,CAAAnD,SAAA,EAAA,aAAA,EAAA,CALCoD,MAAM,CAAA,CAAA;AAAA;EAMPjB,aAAaA,CAACyB,IAAU,EAAEjD,QAAqB,GAAG,IAAI,CAACL,IAAI,CAACK,QAAQ,EAAE;AACpE,IAAA,OAAOA,QAAQ,CAACgC,QAAQ,GACpBkB,MAAM,CAACD,IAAI,EAAEjD,QAAQ,CAACgC,QAAQ,EAAU,KAAK,CAAC,GAC9C,KAAK;AACX;EAEAK,cAAcA,CAACQ,EAAkB,EAAE;AACjC,IAAA,IAAI,CAACtB,SAAS,GAAGsB,EAAE,IAAI,IAAI;AAC7B;AACF;AAACM,oBAAA,CAAAC,QAAA,EA/HoBlE,0BAA0B,CAAA;;;;"}