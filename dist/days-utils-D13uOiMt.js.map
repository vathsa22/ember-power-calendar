{"version":3,"file":"days-utils-D13uOiMt.js","sources":["../src/-private/days-utils.ts"],"sourcesContent":["import { assert } from '@ember/debug';\nimport type { CalendarAPI } from '../components/power-calendar.ts';\nimport {\n  endOf,\n  endOfWeek,\n  formatDate,\n  isAfter,\n  isBefore,\n  isSame,\n  localeStartOfWeek,\n  normalizeCalendarDay,\n  startOf,\n  startOfWeek,\n  type PowerCalendarDay,\n} from '../utils.ts';\n\nexport const WEEK_DAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];\nexport type TWeekdayFormat = 'min' | 'short' | 'long';\n\nexport interface Week {\n  id: string;\n  days: PowerCalendarDay[];\n  missingDays: number;\n}\n\nexport function localeStartOfWeekOrFallback(\n  startOfWeek: string | undefined,\n  locale: string,\n): number {\n  if (startOfWeek) {\n    return parseInt(startOfWeek, 10);\n  }\n  return localeStartOfWeek(locale);\n}\n\nexport function weekdaysNames(\n  localeStartOfWeek: number,\n  weekdayFormat: TWeekdayFormat,\n  weekdays: string[],\n  weekdaysMin: string[],\n  weekdaysShort: string[],\n): string[] {\n  let weekdaysNames;\n  if (weekdayFormat === 'long') {\n    weekdaysNames = weekdays;\n  } else if (weekdayFormat === 'min') {\n    weekdaysNames = weekdaysMin;\n  } else {\n    weekdaysNames = weekdaysShort;\n  }\n  return weekdaysNames\n    .slice(localeStartOfWeek)\n    .concat(weekdaysNames.slice(0, localeStartOfWeek));\n}\n\nexport function firstDay(currentCenter: Date, localeStartOfWeek: number): Date {\n  const firstDay = startOf(currentCenter, 'month');\n  return startOfWeek(firstDay, localeStartOfWeek);\n}\n\nexport function weeks(\n  days: PowerCalendarDay[],\n  showDaysAround: boolean,\n): Week[] {\n  const weeks: Week[] = [];\n  let i = 0;\n  while (days[i]) {\n    let daysOfWeek = days.slice(i, i + 7);\n    if (!showDaysAround) {\n      daysOfWeek = daysOfWeek.filter((d) => d.isCurrentMonth);\n    }\n    weeks.push({\n      id: `week-of-${daysOfWeek[0]?.id}`,\n      days: daysOfWeek,\n      missingDays: 7 - daysOfWeek.length,\n    });\n    i += 7;\n  }\n  return weeks;\n}\n\nexport function handleDayKeyDown(\n  e: KeyboardEvent,\n  focusedId: string | null,\n  days: PowerCalendarDay[],\n): PowerCalendarDay | undefined {\n  if (!focusedId) {\n    return;\n  }\n  let day, index: number | undefined;\n  for (let i = 0; i < days.length; i++) {\n    if (days[i]?.id === focusedId) {\n      index = i;\n      break;\n    }\n  }\n\n  if (!index) {\n    return;\n  }\n\n  if (e.key === 'ArrowUp') {\n    e.preventDefault();\n    const newIndex = Math.max(index - 7, 0);\n    day = days[newIndex];\n    if (day?.isDisabled) {\n      for (let i = newIndex + 1; i <= index; i++) {\n        day = days[i];\n        if (!day?.isDisabled) {\n          break;\n        }\n      }\n    }\n  } else if (e.key === 'ArrowDown') {\n    e.preventDefault();\n    const newIndex = Math.min(index + 7, days.length - 1);\n    day = days[newIndex];\n    if (day?.isDisabled) {\n      for (let i = newIndex - 1; i >= index; i--) {\n        day = days[i];\n        if (!day?.isDisabled) {\n          break;\n        }\n      }\n    }\n  } else if (e.key === 'ArrowLeft') {\n    day = days[Math.max(index - 1, 0)];\n    if (day?.isDisabled) {\n      return;\n    }\n  } else if (e.key === 'ArrowRight') {\n    day = days[Math.min(index + 1, days.length - 1)];\n    if (day?.isDisabled) {\n      return;\n    }\n  } else {\n    return;\n  }\n\n  return day;\n}\n\nexport function focusDate(uniqueId: string, id: string): void {\n  const dayElement: HTMLElement | null = document.querySelector(\n    `[data-power-calendar-id=\"${uniqueId}\"] [data-date=\"${id}\"]`,\n  );\n  if (dayElement) {\n    dayElement.focus();\n  }\n}\n\nexport function buildDay(\n  date: Date,\n  today: Date,\n  calendar: CalendarAPI,\n  focusedId: string | null,\n  currentCenter: Date,\n  dayIsSelected: (date: Date, calendar: CalendarAPI) => boolean,\n  minDate?: Date,\n  maxDate?: Date,\n  disabledDates?: Array<Date | string>,\n  dayIsDisabledExtended?: (\n    date: Date,\n    calendar: CalendarAPI,\n    minDate?: Date,\n    maxDate?: Date,\n    disabledDates?: Array<Date | string>,\n  ) => boolean,\n): PowerCalendarDay {\n  const id = formatDate(date, 'YYYY-MM-DD');\n\n  let isDisabled = false;\n  if (typeof dayIsDisabledExtended === 'function') {\n    isDisabled = dayIsDisabledExtended(\n      date,\n      calendar,\n      minDate,\n      maxDate,\n      disabledDates,\n    );\n  } else {\n    isDisabled = dayIsDisabled(date, calendar, minDate, maxDate, disabledDates);\n  }\n\n  return normalizeCalendarDay({\n    id,\n    number: date.getDate(),\n    date: new Date(date),\n    isDisabled: isDisabled,\n    isFocused: focusedId === id,\n    isCurrentMonth: isSame(date, currentCenter, 'month'),\n    isToday: isSame(date, today, 'day'),\n    isSelected: dayIsSelected(date, calendar),\n  } as PowerCalendarDay);\n}\n\nexport function dayIsDisabled(\n  date: Date,\n  calendar: CalendarAPI,\n  minDate?: Date,\n  maxDate?: Date,\n  disabledDates?: Array<Date | string>,\n): boolean {\n  const isDisabled = !calendar.actions.select;\n  if (isDisabled) {\n    return true;\n  }\n\n  if (minDate && isBefore(date, startOf(minDate, 'day'))) {\n    return true;\n  }\n\n  if (maxDate && isAfter(date, endOf(maxDate, 'day'))) {\n    return true;\n  }\n\n  if (disabledDates) {\n    const disabledInRange = disabledDates.some((d) => {\n      const isSameDay = isSame(date, d as Date, 'day');\n      const isWeekDayIncludes =\n        WEEK_DAYS.indexOf(d as string) !== -1 && formatDate(date, 'ddd') === d;\n      return isSameDay || isWeekDayIncludes;\n    });\n\n    if (disabledInRange) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function lastDay(localeStartOfWeek: number, currentCenter: Date): Date {\n  assert(\n    'The center of the calendar is an invalid date.',\n    !isNaN(currentCenter.getTime()),\n  );\n  const lastDay = endOf(currentCenter, 'month');\n  return endOfWeek(lastDay, localeStartOfWeek);\n}\n\nexport function handleClick(\n  e: MouseEvent,\n  days: PowerCalendarDay[],\n  calendar: CalendarAPI,\n): void {\n  const dayEl: HTMLElement | null | undefined = (\n    e.target as HTMLElement | null\n  )?.closest('[data-date]');\n  if (dayEl) {\n    const dateStr = dayEl.dataset['date'];\n    const day = days.find((d) => d.id === dateStr);\n    if (day) {\n      if (calendar.actions.select) {\n        calendar.actions.select(day, calendar, e);\n      }\n    }\n  }\n}\n"],"names":["WEEK_DAYS","localeStartOfWeekOrFallback","startOfWeek","locale","parseInt","localeStartOfWeek","weekdaysNames","weekdayFormat","weekdays","weekdaysMin","weekdaysShort","slice","concat","firstDay","currentCenter","startOf","weeks","days","showDaysAround","i","daysOfWeek","filter","d","isCurrentMonth","push","id","missingDays","length","handleDayKeyDown","e","focusedId","day","index","key","preventDefault","newIndex","Math","max","isDisabled","min","focusDate","uniqueId","dayElement","document","querySelector","focus","buildDay","date","today","calendar","dayIsSelected","minDate","maxDate","disabledDates","dayIsDisabledExtended","formatDate","dayIsDisabled","normalizeCalendarDay","number","getDate","Date","isFocused","isSame","isToday","isSelected","actions","select","isBefore","isAfter","endOf","disabledInRange","some","isSameDay","isWeekDayIncludes","indexOf","lastDay","assert","isNaN","getTime","endOfWeek","handleClick","dayEl","target","closest","dateStr","dataset","find"],"mappings":"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"}